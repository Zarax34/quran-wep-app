{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2"><i class="fas fa-marker"></i> إدخال درجات اختبار: {{ test.name }}</h1>
    <a href="{{ url_for('manage_tests', course_id=test.course_id) }}" class="btn btn-secondary">
        <i class="fas fa-arrow-right"></i> الرجوع لإدارة الاختبارات
    </a>
</div>

<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">دورة: {{ test.course.name }} - الدرجة القصوى: {{ test.max_score }}</h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    {% if test.course.enrollments.all() %}
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>اسم الطالب</th>
                                    <th>الدرجة المدخلة</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for enrollment in test.course.enrollments %}
                                {% set student = enrollment.student %}
                                {% set current_score = existing_scores.get(student.id) %}
                                <tr>
                                    <td>{{ student.name }}</td>
                                    <td>
                                        <input type="number" step="0.1" name="score_{{ student.id }}" class="form-control"
                                               placeholder="أدخل الدرجة" min="0" max="{{ test.max_score }}"
                                               value="{{ current_score.score if current_score else '' }}">
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-3">
                            <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> حفظ الدرجات</button>
                        </div>
                    {% else %}
                        <div class="alert alert-info">لا يوجد طلاب مسجلون في هذه الدورة لإدخال درجاتهم.</div>
                    {% endif %}
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
